<?php 

//PHP<->app code
//SYSC 3010
//Team M6 Plant Pals
//Author: Emma Maddock
//Description: app inserts plant information into plants table and receives current plant info from plant_data table

//defining the user and password that already have access to the database
$hostname = 'localhost';
$username = 'apache';
$password = 'Temp123!';
$db = 'web_plants';

//establishing a connection
$conn = mysqli_connect($hostname,$username,$password,$db) or die('Cannot connect to the DB');

//getting plant info from the app to insert into the plants table
$plant_name=$_GET['name'];
$ideal_moisture=$_GET['moisture'];
$rig_position=$_GET[''];

//inserting the user's new plant into the plants database
$sql1="insert (plant_name,ideal_moisture,rig_position) into plants values(".$plant_name.",".$ideal_moisture.",".$rig_position.")";
$result1= $conn->query($sql1);

//limits the sql query to the last 3 entries of the plant_data table
$sql2="SELECT pl.plant_name,pd.current_moisture  FROM plant_data pd LEFT JOIN plants pl ON pd.plant_id=pl.id order by pd.id  limit 3;";
$result2= $conn->query($sql2);

//creating an array called plants to send back to the app
$plants = array();


//the loop populates the plants array with the name and current moisture of the last
//3 entries
        while ($row = mysqli_fetch_array($result2)) {

                array_push($plants, $row["plant_name"]);
                array_push($plants, $row["current_moisture"]);
        }
//the plants array is encoded into a json object and echoed (sent back) to the app
echo json_encode($plants);

$conn->close();


?>
